<html>
<head>
<title>role.architect.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,0,128); font-weight: bold; }
.s3 { color: rgb(0,0,255); }
.s4 { color: rgb(0,128,0); font-weight: bold; }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
role.architect.js</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">/** 
 * Created by acastells on 06/07/2016. 
 */</span><span class="s1"> 
 
</span><span class="s2">var </span><span class="s1">roleArchitect = { 
    run: </span><span class="s2">function </span><span class="s1">(creep) { 
        </span><span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">id </span><span class="s2">in </span><span class="s1">Game.rooms) { 
            </span><span class="s2">var </span><span class="s1">room = Game.rooms[id]; 
            </span><span class="s2">var </span><span class="s1">spawn; 
            </span><span class="s2">var </span><span class="s1">numSpawns = </span><span class="s3">0</span><span class="s1">; 
            </span><span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">i </span><span class="s2">in </span><span class="s1">Memory.rooms[room.name].structures){   </span><span class="s0">//Spawn num in room</span><span class="s1"> 
                </span><span class="s2">if</span><span class="s1">(Memory.rooms[room.name].structures[i].structureType == </span><span class="s4">'spawn'</span><span class="s1">){ 
                    numSpawns++; 
                    spawn = Game.getObjectById(Memory.rooms[room.name].structures[i].id); 
                } 
            } 
            </span><span class="s0">/*Create resource routes*/</span><span class="s1"> 
 
            </span><span class="s2">if</span><span class="s1">(numSpawns &lt; </span><span class="s3">2</span><span class="s1">){  </span><span class="s0">//If 1 spawn</span><span class="s1"> 
                </span><span class="s2">var </span><span class="s1">numSources = Memory.rooms[room.name].sources.length; 
                </span><span class="s2">if</span><span class="s1">(!(Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">].length == numSources)){ 
                    </span><span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">i </span><span class="s2">in </span><span class="s1">Memory.rooms[room.name].sources){ 
                        </span><span class="s2">var </span><span class="s1">sourceObject = Game.getObjectById(Memory.rooms[room.name].sources[i].id); 
                        </span><span class="s2">var </span><span class="s1">route = {}; 
                        route.path = Game.spawns[spawn.name].pos.findPathTo(sourceObject); 
                        route.buildingPriority = </span><span class="s2">false</span><span class="s1">; 
                        route.buildFinished = </span><span class="s2">false</span><span class="s1">; 
                        route.repair = </span><span class="s2">true</span><span class="s1">; 
                        route.status = </span><span class="s4">'null'</span><span class="s1">; 
                        route.project = </span><span class="s2">false</span><span class="s1">; 
                        Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">].push(route); 
                    } 
                } 
 
                </span><span class="s0">/*Add priorities to construction points*/</span><span class="s1"> 
                </span><span class="s2">var </span><span class="s1">shortest = -</span><span class="s3">1</span><span class="s1">; 
                </span><span class="s2">var </span><span class="s1">position 
                </span><span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">j </span><span class="s2">in </span><span class="s1">Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">]){ 
                    Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].buildingPriority = </span><span class="s2">false</span><span class="s1">; 
                    </span><span class="s2">if</span><span class="s1">((shortest == -</span><span class="s3">1 </span><span class="s1">|| Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].path.length &lt; shortest) &amp;&amp; Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].buildFinished == </span><span class="s2">false</span><span class="s1">){ 
                        shortest = Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].path.length; 
                        position = j; 
                    } 
                } 
                Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][position].buildingPriority = </span><span class="s2">true</span><span class="s1">; 
 
 
                </span><span class="s0">/*Designate construction points*/</span><span class="s1"> 
                </span><span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">j </span><span class="s2">in </span><span class="s1">Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">]){ 
                    </span><span class="s2">if</span><span class="s1">(Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].buildingPriority == </span><span class="s2">true </span><span class="s1">&amp;&amp; Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].process == </span><span class="s4">'null'</span><span class="s1">){ 
                        </span><span class="s2">var </span><span class="s1">constuctionPoints = []; 
                        </span><span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">k </span><span class="s2">in </span><span class="s1">Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].path){ 
                            constuctionPoints.push(Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].path[k]); 
 
                            </span><span class="s0">//Game.rooms[room.name].createConstructionSite(pathRoute.x,pathRoute.y, STRUCTURE_ROAD);</span><span class="s1"> 
                        } 
                        Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].constructionPoints = constuctionPoints; 
                        Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].process = </span><span class="s4">'waiting'</span><span class="s1">; 
                        Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].project = </span><span class="s2">true</span><span class="s1">; 
                    } 
 
                } 
 
 
            } 
            </span><span class="s2">else</span><span class="s1">{} 
 
            </span><span class="s0">/*Create projects*/</span><span class="s1"> 
 
            </span><span class="s2">if</span><span class="s1">(!Memory.rooms[room.name].projects){ 
                Memory.rooms[room.name].projects = [];  </span><span class="s0">//Project Array</span><span class="s1"> 
            } 
            </span><span class="s2">else </span><span class="s1">{ 
                </span><span class="s0">//Code for creating and maintaining projects</span><span class="s1"> 
                </span><span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">j </span><span class="s2">in </span><span class="s1">Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">]){ 
                   </span><span class="s2">if</span><span class="s1">(Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].process == </span><span class="s4">'waiting' </span><span class="s1">&amp;&amp; Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].project == </span><span class="s2">true</span><span class="s1">){ 
                       </span><span class="s2">var </span><span class="s1">project = {}; 
                       project.process = </span><span class="s3">0</span><span class="s1">+</span><span class="s4">'%'</span><span class="s1">; 
                       project.constuctionPoints = Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].constructionPoints; 
                       Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].buildingPriority.push(project); 
                       Memory.rooms[room.name].architectLog[</span><span class="s3">0</span><span class="s1">][j].process = </span><span class="s4">'working'</span><span class="s1">; 
                   } 
                } 
            } 
        } 
    } 
}; 
module.exports = roleArchitect;</span></pre>
</body>
</html>